(* 顶层规则 *)
text          = { directive | literal } ;

(* 基础元素 *)
literal       = ? any character except ':' and whitespace ? ;
string        = '"', { ? any character except '"' ? }, '"' ; (* 字符串字面量，如 "a" *)
name          = ? alphanumeric string ? ;
integer       = ? positive integer ? ;

(* 指令必须显式分组 *)
directive     = '(', directive_head, { pattern }, ')' ;
directive_head = ':any-of' 
               | ':seq' 
               | ':optional' 
               | ':repeat' 
               | ':once-or-more' 
               | ':any-times' 
               | ':submatch' ;

(* 模式可以是：指令、字符串字面量、字符字面量或分组 *)
pattern       = directive | string | literal | '(', text, ')' ; (* 允许直接字符串和显式分组 *)

(* 指令专用参数约束 *)
':repeat'    = '(', ':repeat', integer, integer, pattern, ')' ; (* 如 (:repeat 1 3 "a") *)
':submatch'  = '(', ':submatch', name, pattern, ')' ;
':any-of'    = '(', ':any-of', { pattern }, ')' ;
':seq'       = '(', ':seq', { pattern }, ')' ;
':optional'  = '(', ':optional', pattern, ')' ;
':once-or-more' = '(', ':once-or-more', pattern, ')' ;
':any-times' = '(', ':any-times', pattern, ')' ;
